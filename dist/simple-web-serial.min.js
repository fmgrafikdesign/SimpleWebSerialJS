!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SimpleWebSerial=t():e.SimpleWebSerial=t()}(globalThis,()=>(()=>{"use strict";var e={};e.d=function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{setupSerialConnection:()=>a});class r{transform(e,t){try{this.chunks+=e;let r=this.chunks.split("\r\n");this.chunks=r.pop(),r.forEach(e=>t.enqueue(e))}catch(e){console.error(`Transformation Error: ${e}`)}}flush(e){try{e.enqueue(this.chunks)}catch(e){console.error(`Flushing Error: ${e}`)}}constructor(){this.chunks=""}}function n(e){return"number"==typeof e?e:"string"!=typeof e||isNaN(e)||""===e.trim()?Array.isArray(e)?e.map(e=>n(e)):"object"==typeof e&&null!==e?Object.keys(e).reduce((t,r)=>({...t,[r]:n(e[r])}),{}):e:parseFloat(e)}function o(){return{baudRate:57600,requestElement:null,requestAccessOnPageLoad:!1,accessText:"To access serial devices, user interaction is required. Please press this button to select the serial device you want to connect to.",accessButtonLabel:"Choose device / port",styleDomElements:!0,transformer:new r,logIncomingSerialData:!1,logOutgoingSerialData:!1,parseStringsAsNumbers:!0,warnAboutUnregisteredEvents:!0,newLineCharacter:"\n",filters:[]}}let a=function(e){if(!navigator.serial)throw Error("The Serial API not supported in your browser. Make sure you've enabled flags if necessary!");"number"==typeof e?e={...o(),baudRate:e}:void 0===e?e=o():"object"==typeof e&&(e={...o(),...e}),null!=e.requestElement&&(e={...e,requestAccessOnPageLoad:!1});let t=e,r=function(e){let t=null,r=null,o=null,a=null,i={};function s(e){if("string"==typeof e){let t=document.getElementById(e);if(!t)throw Error("Could not find element with ID '"+e+"'.");e=t}e.addEventListener("click",l)}async function l(){if(u())throw Error("Serial connection has already been established.");try{t=await navigator.serial.requestPort({filters:e.filters}),await t.open({baudRate:e.baudRate})}catch(e){var n;throw n="There was an error trying to open a serial connection. Please make sure the port is not occupied in another tab or process. Error message:<br>"+e,!a||(a.innerHTML=n),Error(e)}e.requestAccessOnPageLoad&&(null==o||o.remove());let i=new TextEncoderStream;r=i.writable.getWriter();let s=new TextDecoderStream;i.readable.pipeTo(t.writable),t.readable.pipeTo(s.writable),b(s.readable.pipeThrough(new TransformStream(e.transformer)).getReader()).then(e=>{console.log(e,"readLoop done")}).catch(t=>{console.error("Could not read serial data. Please make sure the same baud rate is used on device (Serial.begin()) and library. Library currently uses baud rate",e.baudRate,"Please also make sure you're not sending too much serial data. Consider using (a higher) delay() to throttle the amount of data sent."),console.error(t)})}function u(){return(null==t?void 0:t.readable)&&(null==t?void 0:t.writable)}async function c(o,a){if(!(null==t?void 0:t.writable))return;if(void 0===a)return e.logOutgoingSerialData&&console.log(o),e.parseStringsAsNumbers&&(o=n(o)),f(o);e.parseStringsAsNumbers&&(a=n(a));let i=JSON.stringify([o,a]);return e.logOutgoingSerialData&&console.log(i),r.write(i+e.newLineCharacter)}async function d(e){return c("_e",e)}async function f(e){return c("_d",e)}function p(t,r){if(i[t])i[t].forEach(e=>e(r));else if(e.warnAboutUnregisteredEvents)return console.warn("Event "+t+" has been received, but it has never been registered as listener.")}async function b(t){for(;;){let{value:r,done:n}=await t.read();if(r){let t=null;try{t=JSON.parse(r)}catch{}if(t){if(e.logIncomingSerialData&&console.log(t),"object"==typeof t){if("_w"===t[0]){console.warn("[ARDUINO] "+t[1]);continue}if("_l"===t[0]){console.log("[ARDUINO] "+t[1]);continue}if("_e"===t[0]){console.error("[ARDUINO] "+t[1]);continue}if("_d"===t[0]){p("data",t[1]);continue}p(t[0],t[1])}else"string"==typeof t&&p(t,null)}else e.logIncomingSerialData&&console.log(r)}if(n){console.log("[readLoop] DONE",n),t.releaseLock();break}}}return{configuration:e,createModal:function(){let[t,r,n,i,l,u,c]=["div","div","div","div","p","p","button"].map(e=>document.createElement(e));return n.classList.add("SimpleWebSerial-modal-container"),r.classList.add("SimpleWebSerial-modal-overlay"),i.classList.add("SimpleWebSerial-modal-inner"),e.styleDomElements&&(t.setAttribute("style","position: fixed; left: 0; top: 0; width: 100%; height: 100%; left: 0; top: 0; z-index: 10000"),r.setAttribute("style","background-color: rgba(0,0,0,.3); position: absolute; left: 0; top: 0; width: 100%; height: 100%; left: 0; top: 0; cursor: pointer"),n.setAttribute("style","position: absolute; width: 100%; height: auto; padding: 4rem; box-sizing: border-box;"),i.setAttribute("style","background-color: #fff; border-radius: 4px; padding: 1rem; box-shadow: 0px 2px 11px 4px rgba(0,0,0, .09);"),l.setAttribute("style","color: #000"),u.setAttribute("style","color: #dd0000")),l.innerText=e.accessText,c.innerText=e.accessButtonLabel,s(c),i.append(l,u,c),n.append(i),t.append(r,n),o=t,a=u,document.body.append(t),t},emit:p,modalElement:o,on:function(e,t){return!i[e]&&(i[e]=[]),i[e].push(t),[e,t]},getPort:function(){return t},ready:u,readable:function(){return null==t?void 0:t.readable},removeListener:function(e,t){if("object"==typeof e&&void 0===t&&(t=e[1],e=e[0]),!i[e])throw Error("There is no listener named "+e+".");let r=i[e].length;return i[e]=i[e].filter(e=>e!==t),r!==i[e].length},removeListeners:function(e){if("string"!=typeof e)throw Error("removeListeners expects a string as parameter, which will be used to remove all listeners of that event.");let t=i[e].length;return i[e]=[],t>0},requestSerialAccessOnClick:s,send:c,sendData:f,sendEvent:d,startConnection:l,writable:function(){return null==t?void 0:t.writable},writer:r,getWriter:function(){return r},setWriter:function(e){return r=e}}}(t);return t.requestElement&&r.requestSerialAccessOnClick(t.requestElement),t.requestAccessOnPageLoad&&window.addEventListener("load",r.createModal),r};return t})());
//# sourceMappingURL=simple-web-serial.min.js.map